<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Automated State Testing - Alfabeto Modular</title>
    <style>
        body {
            font-family: 'Courier New', monospace;
            background: #1a1a1a;
            color: #00ff00;
            padding: 20px;
            max-width: 1000px;
            margin: 0 auto;
        }
        h1 { color: #00ff00; border-bottom: 2px solid #00ff00; padding-bottom: 10px; }
        .status { padding: 10px; margin: 10px 0; border-left: 4px solid; }
        .pass { border-color: #00ff00; background: rgba(0,255,0,0.1); }
        .fail { border-color: #ff0000; background: rgba(255,0,0,0.1); color: #ff0000; }
        .running { border-color: #ffaa00; background: rgba(255,170,0,0.1); color: #ffaa00; }
        #console-log { 
            background: #000; 
            border: 1px solid #00ff00; 
            padding: 15px; 
            height: 300px; 
            overflow-y: auto; 
            margin: 20px 0;
            font-size: 12px;
        }
        button {
            background: #00ff00;
            color: #000;
            border: none;
            padding: 15px 30px;
            font-size: 16px;
            cursor: pointer;
            margin: 10px 5px;
            font-weight: bold;
        }
        button:hover { background: #00cc00; }
        button:disabled { background: #555; color: #888; cursor: not-allowed; }
        .error-count { color: #ff0000; font-weight: bold; font-size: 20px; }
        iframe { width: 100%; height: 600px; border: 2px solid #00ff00; margin: 20px 0; }
    </style>
</head>
<body>
    <h1>ü§ñ ALFABETO MODULAR - AUTOMATED STATE TEST</h1>
    
    <div>
        <button id="startTest" onclick="runFullTest()">‚ñ∂ RUN FULL TEST</button>
        <button id="stopTest" onclick="stopTest()" disabled>‚èπ STOP</button>
        <button onclick="clearLog()">üóë CLEAR LOG</button>
    </div>

    <div id="status" class="status running">‚è≥ Ready to start testing...</div>
    
    <h3>üìä Test Results</h3>
    <div>
        Steps Completed: <span id="stepCount">0</span> / 10<br>
        Console Errors: <span id="errorCount" class="error-count">0</span><br>
        Status: <span id="testStatus">NOT STARTED</span>
    </div>

    <h3>üìã Console Log</h3>
    <div id="console-log"></div>

    <h3>üñº Application Under Test</h3>
    <iframe id="testFrame" src="index.html"></iframe>

    <script>
        let testRunning = false;
        let stepCount = 0;
        let errorCount = 0;
        let consoleErrors = [];

        const log = (msg, isError = false) => {
            const consoleLog = document.getElementById('console-log');
            const timestamp = new Date().toLocaleTimeString();
            const color = isError ? '#ff0000' : '#00ff00';
            consoleLog.innerHTML += `<div style="color:${color}">[${timestamp}] ${msg}</div>`;
            consoleLog.scrollTop = consoleLog.scrollHeight;
        };

        const clearLog = () => {
            document.getElementById('console-log').innerHTML = '';
        };

        const updateStatus = (msg, type = 'running') => {
            const statusDiv = document.getElementById('status');
            statusDiv.textContent = msg;
            statusDiv.className = `status ${type}`;
        };

        const sleep = (ms) => new Promise(resolve => setTimeout(resolve, ms));

        // Intercept console errors from iframe
        window.addEventListener('message', (e) => {
            if (e.data.type === 'console-error') {
                errorCount++;
                consoleErrors.push(e.data.message);
                document.getElementById('errorCount').textContent = errorCount;
                log(`‚ùå CONSOLE ERROR: ${e.data.message}`, true);
            }
        });

        async function runFullTest() {
            if (testRunning) return;
            
            testRunning = true;
            stepCount = 0;
            errorCount = 0;
            consoleErrors = [];
            
            document.getElementById('startTest').disabled = true;
            document.getElementById('stopTest').disabled = false;
            document.getElementById('stepCount').textContent = '0';
            document.getElementById('errorCount').textContent = '0';
            document.getElementById('testStatus').textContent = 'RUNNING';
            
            log('üöÄ Starting comprehensive state test...');
            
            const frame = document.getElementById('testFrame');
            const win = frame.contentWindow;
            
            await sleep(2000); // Let app initialize
            
            try {
                // Step 1: Initial state
                log('Step 1: Checking initial load...');
                stepCount++; updateStep();
                await sleep(2000);

                // Step 2: Toggle theme (Day mode)
                log('Step 2: Toggling theme to DAY mode...');
                clickButton(win, '#themeButton');
                stepCount++; updateStep();
                await sleep(2000);

                // Step 3: Switch to Generator
                log('Step 3: Switching to GENERATOR mode...');
                clickButton(win, '[data-mode="generator"]');
                stepCount++; updateStep();
                await sleep(2000);

                // Step 4: Type text
                log('Step 4: Typing "HOLA MUNDO" in generator...');
                const input = win.document.getElementById('textInput');
                if (input) {
                    input.value = 'HOLA MUNDO';
                    input.dispatchEvent(new Event('input'));
                }
                stepCount++; updateStep();
                await sleep(2000);

                // Step 5: Toggle theme in Generator
                log('Step 5: Toggling theme to NIGHT mode in generator...');
                clickButton(win, '#themeButton');
                stepCount++; updateStep();
                await sleep(2000);

                // Step 6: Enable color hints
                log('Step 6: Enabling COLOR HINTS...');
                clickButton(win, '#colorHintsButton');
                stepCount++; updateStep();
                await sleep(2000);

                // Step 7: Switch to Game
                log('Step 7: Switching to GAME mode...');
                clickButton(win, '[data-mode="game"]');
                stepCount++; updateStep();
                await sleep(2000);

                // Step 8: Toggle theme in Game
                log('Step 8: Toggling theme to DAY mode in game...');
                clickButton(win, '#themeButton');
                stepCount++; updateStep();
                await sleep(2000);

                // Step 9: Back to Home
                log('Step 9: Switching back to HOME...');
                clickButton(win, '[data-mode="home"]');
                stepCount++; updateStep();
                await sleep(2000);

                // Step 10: Disable color hints
                log('Step 10: Disabling COLOR HINTS...');
                clickButton(win, '#colorHintsButton');
                stepCount++; updateStep();
                await sleep(2000);

                // Final assessment
                log('‚úÖ Test sequence completed!');
                
                if (errorCount === 0) {
                    updateStatus('‚úÖ ALL TESTS PASSED - No console errors detected!', 'pass');
                    document.getElementById('testStatus').textContent = 'PASS ‚úÖ';
                } else {
                    updateStatus(`‚ùå TEST FAILED - ${errorCount} console error(s) detected`, 'fail');
                    document.getElementById('testStatus').textContent = 'FAIL ‚ùå';
                    log('Errors found:', true);
                    consoleErrors.forEach(err => log(`  - ${err}`, true));
                }
                
            } catch (error) {
                log(`‚ùå TEST CRASHED: ${error.message}`, true);
                updateStatus('üí• Test crashed with exception', 'fail');
                document.getElementById('testStatus').textContent = 'CRASH ‚ùå';
            }
            
            testRunning = false;
            document.getElementById('startTest').disabled = false;
            document.getElementById('stopTest').disabled = true;
        }

        function clickButton(win, selector) {
            const btn = win.document.querySelector(selector);
            if (btn) {
                btn.click();
                log(`  ‚û§ Clicked: ${selector}`);
            } else {
                log(`  ‚ö† Button not found: ${selector}`, true);
            }
        }

        function updateStep() {
            document.getElementById('stepCount').textContent = stepCount;
        }

        function stopTest() {
            testRunning = false;
            updateStatus('‚èπ Test stopped by user', 'fail');
            document.getElementById('startTest').disabled = false;
            document.getElementById('stopTest').disabled = true;
        }

        log('‚ú® Test harness loaded. Click "RUN FULL TEST" to begin.');
    </script>
</body>
</html>
